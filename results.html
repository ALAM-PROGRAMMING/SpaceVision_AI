{% extends "base.html" %}
{% block content %}
{% if result %}
    <div class="row">
        <div class="col-md-6">
          <img src="{{ url_for('static', filename='uploads/' + result.result_img_filename) }}" class="img-fluid rounded shadow">
        </div>
        <div class="col-md-6">
            <h4>Detection Results</h4>
            <ul class="list-group">
                {% for det in result['detections'] %}
                    <li class="list-group-item d-flex justify-content-between align-items-center
                        {% if det.name in critical_objects and det.conf < 0.5 %}list-group-item-danger{% elif det.name in critical_objects %}list-group-item-success{% endif %}">
                        <span>
                            <strong>{{ det.name }}</strong>
                            <span class="badge bg-secondary ms-2">{{ "%.2f"|format(det.conf) }}</span>
                        </span>
                        {% if det.name in critical_objects and det.conf < 0.5 %}
                            <span class="text-danger fw-bold">Low Confidence!</span>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
            <hr>
            <h5>Critical Equipment Status:</h5>
            <ul>
                {% for obj in critical_objects %}
                    {% set found = result['detections']|selectattr('name', 'equalto', obj)|list %}
                    {% if found %}
                        {% if found[0].conf < 0.5 %}
                            <li class="text-warning">{{ obj }} detected with low confidence!</li>
                        {% else %}
                            <li class="text-success">{{ obj }} detected.</li>
                        {% endif %}
                    {% else %}
                        <li class="text-danger">{{ obj }} missing!</li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    </div>
{% elif history %}
    <h4>Detection History</h4>
    <ul class="list-group">
        {% for item in history %}
            <li class="list-group-item">
                <img src="{{ url_for('static', filename='uploads/' + item.result_img_filename) }}" width="120" class="me-3 rounded">

                <span>{{ item['filename'] }}</span>
                <span class="ms-3">{{ item['detections']|length }} objects detected</span>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No results to show.</p>
{% endif %}
{% endblock %}